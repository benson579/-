<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‹¥æ…ˆæ•¸ä½åç‰‡åŠ©æ‰‹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #0F172A; }
        .gold-bg { background: linear-gradient(135deg, #C0A062 0%, #a68a52 100%); }
    </style>
    <!-- å…¨åŸŸéŒ¯èª¤æ””æˆªå™¨ -->
    <script>
        window.onerror = function(message, source, lineno, colno, error) {
            const errorDiv = document.getElementById('debugInfo');
            if (errorDiv) {
                errorDiv.style.display = 'block';
                errorDiv.innerText = "ç³»çµ±éŒ¯èª¤: " + message + "\nè¡Œæ•¸: " + lineno;
            }
            const ui = document.getElementById('errorUI');
            const det = document.getElementById('errorDetail');
            if(ui && det) {
                // å¿½ç•¥ resize loop éŒ¯èª¤ï¼Œé€™åœ¨æŸäº›ç€è¦½å™¨æ˜¯ç„¡å®³çš„
                if(message && message.includes("ResizeObserver loop")) return;
                
                ui.classList.remove('hidden');
                document.getElementById('statusUI').classList.add('hidden');
                det.innerText = "ç¨‹å¼åŸ·è¡ŒéŒ¯èª¤: " + message;
            }
        };
    </script>
</head>
<body class="min-h-screen flex items-center justify-center p-6 text-center text-white">

    <div class="max-w-xs w-full">
        <!-- ç‹€æ…‹é¡¯ç¤º -->
        <div id="statusUI">
            <div class="w-12 h-12 border-4 border-[#C0A062] border-t-transparent rounded-full animate-spin mx-auto mb-6"></div>
            <h1 class="text-xl font-bold mb-2 tracking-wide">ç³»çµ±å•Ÿå‹•ä¸­</h1>
            <p id="statusDesc" class="text-gray-400 text-sm">æ­£åœ¨å–šé†’æ•¸ä½åç‰‡...</p>
        </div>

        <!-- æ‰‹å‹•ç™¼é€æŒ‰éˆ• (ç•¶è‡ªå‹•ç™¼é€è¢«å–æ¶ˆæˆ–å¤±æ•—æ™‚é¡¯ç¤º) -->
        <div id="manualUI" class="hidden">
            <div class="w-16 h-16 gold-bg rounded-2xl mx-auto mb-6 flex items-center justify-center shadow-2xl">
                <i class="fas fa-paper-plane text-white text-2xl"></i>
            </div>
            <h1 class="text-xl font-bold mb-2">åç‰‡å·²å°±ç·’</h1>
            <p class="text-gray-400 text-xs mb-8">é»æ“Šä¸‹æ–¹æŒ‰éˆ•é–‹å§‹åˆ†äº«</p>
            <button onclick="sendRoseCard()" class="w-full py-4 gold-bg text-white rounded-2xl font-black text-lg active:scale-95 transition-all shadow-lg hover:shadow-yellow-600/20">
                ç™¼é€åç‰‡
            </button>
        </div>

        <!-- éŒ¯èª¤ UI -->
        <div id="errorUI" class="hidden">
            <div class="bg-red-500/10 border border-red-500/50 p-6 rounded-3xl text-left">
                <h1 class="text-red-400 font-bold mb-2 text-center">ç™¼ç”ŸéŒ¯èª¤</h1>
                <p id="errorDetail" class="text-gray-300 text-xs break-all font-mono mb-4"></p>
                <div id="envInfo" class="text-[10px] text-gray-500 border-t border-gray-700 pt-2 font-mono"></div>
                <button onclick="window.location.reload()" class="w-full mt-4 py-2 bg-white/10 rounded text-xs uppercase hover:bg-white/20">é‡æ–°è¼‰å…¥</button>
            </div>
        </div>
        
        <div id="debugInfo" style="display:none; position:fixed; bottom:0; left:0; width:100%; background:rgba(0,0,0,0.9); color:red; font-size:10px; padding:10px; text-align:left; z-index:9999;"></div>
    </div>

    <script>
        // è‹¥æ…ˆçš„ LIFF ID
        const MY_LIFF_ID = "2009033701-68BHXEWs"; 

        // åœ–ç‰‡è³‡æº (è‹¥æ…ˆç‰ˆ)
        const IMG_SERVICE = "https://i.postimg.cc/PJJfxyfP/VIP_%E8%B2%A1%E5%8B%99%E7%AD%96%E5%8A%83%E6%9B%B8_16%E6%AF%949.png";
        const IMG_COMPANY = "https://i.postimg.cc/3NNrR1rY/%E5%9C%96%E7%89%871.jpg";
        const IMG_PROFILE = "https://i.postimg.cc/QCh6Bp0M/S-5316733.jpg"; // è‹¥æ…ˆçš„ç…§ç‰‡

        const roseJson = {
          "type": "carousel",
          "contents": [
            // === ç¬¬ä¸€å¼µå¡ç‰‡ (äººç‰©ç…§) ===
            {
              "type": "bubble",
              "size": "mega",
              "header": {
                "type": "box", "layout": "vertical", "backgroundColor": "#111111", "paddingAll": "16px",
                "contents": [
                  { "type": "text", "text": "PROFESSIONAL PROFILE", "color": "#C0A062", "size": "xxs", "weight": "bold" },
                  { "type": "text", "text": "01", "color": "#222222", "align": "end", "size": "3xl", "weight": "bold", "position": "absolute", "offsetTop": "5px", "offsetEnd": "15px" }
                ]
              },
              "hero": {
                "type": "image",
                "url": IMG_PROFILE,
                "size": "full", "aspectRatio": "1:1", "aspectMode": "cover", "backgroundColor": "#F3F4F6"
              },
              "body": {
                "type": "box", "layout": "vertical", "paddingAll": "20px",
                "contents": [
                  { "type": "text", "text": "è‹¥æ…ˆ Rose", "weight": "bold", "size": "xl", "color": "#111827" },
                  { "type": "text", "text": "å¾¡è¬™VIPèè‹±æœƒ", "size": "xs", "color": "#C0A062", "margin": "xs", "weight": "bold" },
                  { "type": "separator", "margin": "md", "color": "#EEEEEE" },
                  { "type": "box", "layout": "vertical", "margin": "md", "spacing": "sm",
                    "contents": [
                      { "type": "box", "layout": "baseline", "spacing": "sm", "contents": [ { "type": "text", "text": "â˜…", "color": "#C0A062", "size": "sm", "flex": 0 }, { "type": "text", "text": "CIA500 å¼·åœ˜éšŠ", "color": "#666666", "size": "sm", "flex": 1, "wrap": true, "weight": "bold" } ] },
                      { "type": "box", "layout": "baseline", "spacing": "sm", "contents": [ { "type": "text", "text": "â˜…", "color": "#C0A062", "size": "sm", "flex": 0 }, { "type": "text", "text": "åœ˜éšŠç´¯ç©ç®¡ç†å®¢æˆ¶è³‡é‡‘é«˜é” 20 å„„", "color": "#666666", "size": "sm", "flex": 1, "wrap": true, "weight": "bold" } ] },
                      { "type": "box", "layout": "baseline", "spacing": "sm", "contents": [ { "type": "text", "text": "â˜…", "color": "#C0A062", "size": "sm", "flex": 0 }, { "type": "text", "text": "å…¨å° RFP è²¡å‹™ç­–åŠƒå¸«æœ€é«˜æ¿ƒåº¦åœ˜éšŠ", "color": "#666666", "size": "sm", "flex": 1, "wrap": true, "weight": "bold" } ] }
                    ]
                  }
                ]
              },
              "footer": {
                "type": "box", "layout": "vertical", "spacing": "sm", "paddingAll": "16px",
                "contents": [
                  { "type": "button", "style": "primary", "height": "sm", "color": "#C0A062", "action": { "type": "uri", "label": "âœ¨ åŠ  LINE å¥½å‹", "uri": "https://line.me/ti/p/Mr5JeZFTkv" } },
                  { "type": "button", "style": "primary", "height": "sm", "color": "#404040", "action": { "type": "uri", "label": "ğŸ“ è«®è©¢è¡¨å–®é€£çµ", "uri": "https://financesheet-1.vercel.app/" } },
                  { "type": "button", "style": "primary", "height": "sm", "color": "#404040", "action": { "type": "uri", "label": "â¤ åˆ†äº«çµ¦å¥½å‹", "uri": "https://liff.line.me/" + MY_LIFF_ID } }
                ]
              }
            },
            // === ç¬¬äºŒå¼µå¡ç‰‡ (è²¡å‹™æ›¸) ===
            {
              "type": "bubble",
              "size": "mega",
              "header": {
                "type": "box", "layout": "vertical", "backgroundColor": "#111111", "paddingAll": "16px",
                "contents": [
                  { "type": "text", "text": "SERVICES & SOLUTIONS", "color": "#C0A062", "size": "xxs", "weight": "bold" },
                  { "type": "text", "text": "02", "color": "#222222", "align": "end", "size": "3xl", "weight": "bold", "position": "absolute", "offsetTop": "5px", "offsetEnd": "15px" }
                ]
              },
              "hero": {
                "type": "image",
                "url": IMG_SERVICE,
                "size": "full", 
                "aspectRatio": "1:1", 
                "aspectMode": "fit", 
                "backgroundColor": "#1a1a1a"
              },
              "body": {
                "type": "box", "layout": "vertical", "paddingAll": "20px",
                "contents": [
                  { "type": "text", "text": "å®¢è£½åŒ–è²¡å‹™ç­–åŠƒæ›¸", "weight": "bold", "size": "xl", "color": "#111827" },
                  { "type": "text", "text": "WEALTH MANAGEMENT", "size": "xs", "color": "#9ca3af", "margin": "xs" },
                  { "type": "separator", "margin": "md", "color": "#EEEEEE" },
                  { "type": "box", "layout": "vertical", "margin": "md", "spacing": "sm",
                    "contents": [
                      { "type": "box", "layout": "baseline", "spacing": "sm", "contents": [ { "type": "text", "text": "â˜…", "color": "#C0A062", "size": "sm", "flex": 0 }, { "type": "text", "text": "é‡‘æµè¦åŠƒ - æˆ¿è²¸æ¸›å… | é€€ä¼‘è¦åŠƒ", "color": "#666666", "size": "sm", "flex": 1, "wrap": true, "weight": "bold" } ] },
                      { "type": "box", "layout": "baseline", "spacing": "sm", "contents": [ { "type": "text", "text": "â˜…", "color": "#C0A062", "size": "sm", "flex": 0 }, { "type": "text", "text": "é¢¨éšªè¦åŠƒ - æ¸›å°‘ä¿è²» | æé«˜ä¿éšœ", "color": "#666666", "size": "sm", "flex": 1, "wrap": true, "weight": "bold" } ] },
                      { "type": "box", "layout": "baseline", "spacing": "sm", "contents": [ { "type": "text", "text": "â˜…", "color": "#C0A062", "size": "sm", "flex": 0 }, { "type": "text", "text": "è²¡å‹™è¦åŠƒ - è³‡ç”¢é…ç½® | ä¿¡è²¸æ•´åˆ", "color": "#666666", "size": "sm", "flex": 1, "wrap": true, "weight": "bold" } ] },
                      { "type": "box", "layout": "baseline", "spacing": "sm", "contents": [ { "type": "text", "text": "â˜…", "color": "#C0A062", "size": "sm", "flex": 0 }, { "type": "text", "text": "æ•™è‚²æ—…éŠ - å­å¥³æ•™è‚² | å…è²»å‡ºåœ‹", "color": "#666666", "size": "sm", "flex": 1, "wrap": true, "weight": "bold" } ] },
                      { "type": "box", "layout": "baseline", "spacing": "sm", "contents": [ { "type": "text", "text": "â˜…", "color": "#C0A062", "size": "sm", "flex": 0 }, { "type": "text", "text": "å®¶æ—å‚³æ‰¿ - ä¿¡è¨— | å‚³æ‰¿ | å°Šåš´", "color": "#666666", "size": "sm", "flex": 1, "wrap": true, "weight": "bold" } ] }
                    ]
                  }
                ]
              },
              "footer": {
                "type": "box", "layout": "vertical", "spacing": "sm", "paddingAll": "16px",
                "contents": [
                  { "type": "button", "style": "primary", "height": "sm", "color": "#C0A062", "action": { "type": "uri", "label": "ğŸ“œ ä»€éº¼æ˜¯ RFP?", "uri": "https://www.rfpi.com.tw/portal_a1.php?owner_num=a1_205771&button_num=a1" } },
                  { "type": "button", "style": "primary", "height": "sm", "color": "#404040", "action": { "type": "uri", "label": "ğŸ“· instagram", "uri": "https://www.instagram.com/zzz_24hr" } },
                  { "type": "button", "style": "primary", "height": "sm", "color": "#404040", "action": { "type": "uri", "label": "ğŸ“˜ facebook", "uri": "https://www.facebook.com/ruonuo?mibextid=LQQJ4d" } }
                ]
              }
            },
            // === ç¬¬ä¸‰å¼µå¡ç‰‡ (å…¬å¸ç…§) ===
            {
              "type": "bubble",
              "size": "mega",
              "header": {
                "type": "box", "layout": "vertical", "backgroundColor": "#111111", "paddingAll": "16px",
                "contents": [
                  { "type": "text", "text": "COMPANY OVERVIEW", "color": "#C0A062", "size": "xxs", "weight": "bold" },
                  { "type": "text", "text": "03", "color": "#222222", "align": "end", "size": "3xl", "weight": "bold", "position": "absolute", "offsetTop": "5px", "offsetEnd": "15px" }
                ]
              },
              "hero": {
                "type": "image",
                "url": IMG_COMPANY,
                "size": "full", 
                "aspectRatio": "1:1", 
                "aspectMode": "fit", 
                "backgroundColor": "#1a1a1a"
              },
              "body": {
                "type": "box", "layout": "vertical", "paddingAll": "20px",
                "contents": [
                  { "type": "text", "text": "å¾¡è¬™VIPèè‹±æœƒ", "weight": "bold", "size": "xl", "color": "#111827" },
                  { "type": "text", "text": "GROUP PROFILE", "size": "xs", "color": "#9ca3af", "margin": "xs" },
                  { "type": "separator", "margin": "md", "color": "#EEEEEE" },
                  { "type": "box", "layout": "vertical", "margin": "md", "spacing": "sm",
                    "contents": [
                      { "type": "box", "layout": "baseline", "spacing": "sm", "contents": [ { "type": "text", "text": "â˜…", "color": "#C0A062", "size": "sm", "flex": 0 }, { "type": "text", "text": "ä¸–ç•Œ CIA500 å¼·åœ˜éšŠ", "color": "#666666", "size": "sm", "flex": 1, "wrap": true, "weight": "bold" } ] },
                      { "type": "box", "layout": "baseline", "spacing": "sm", "contents": [ { "type": "text", "text": "â˜…", "color": "#C0A062", "size": "sm", "flex": 0 }, { "type": "text", "text": "[å°ˆå±¬è²¡å‹™è¦åŠƒ] å®¢è£½åŒ–æ–¹æ¡ˆ", "color": "#666666", "size": "sm", "flex": 1, "wrap": true, "weight": "bold" } ] },
                      { "type": "box", "layout": "baseline", "spacing": "sm", "contents": [ { "type": "text", "text": "â˜…", "color": "#C0A062", "size": "sm", "flex": 0 }, { "type": "text", "text": "[äººæ‰åŸ¹è¨“è¦åŠƒ] ç™¾è¬å¹´è–ªåŸ¹è¨“", "color": "#666666", "size": "sm", "flex": 1, "wrap": true, "weight": "bold" } ] },
                      { "type": "box", "layout": "baseline", "spacing": "sm", "contents": [ { "type": "text", "text": "â˜…", "color": "#C0A062", "size": "sm", "flex": 0 }, { "type": "text", "text": "[è³‡æºæ•´åˆæœå‹™] å°ˆæ¥­æœƒè¨ˆå¸«åˆä½œ", "color": "#666666", "size": "sm", "flex": 1, "wrap": true, "weight": "bold" } ] },
                      { "type": "box", "layout": "baseline", "spacing": "sm", "contents": [ { "type": "text", "text": "â˜…", "color": "#C0A062", "size": "sm", "flex": 0 }, { "type": "text", "text": "[è²¡ç¶“æ•™è‚²è¬›åº§] ç¨…å‹™æŠ•è³‡è¬›åº§", "color": "#666666", "size": "sm", "flex": 1, "wrap": true, "weight": "bold" } ] }
                    ]
                  }
                ]
              },
              "footer": {
                "type": "box", "layout": "vertical", "spacing": "sm", "paddingAll": "16px",
                "contents": [
                  { "type": "button", "style": "primary", "height": "sm", "color": "#C0A062", "action": { "type": "uri", "label": "ğŸ“· å¾¡è¬™ Instagram", "uri": "https://www.instagram.com/youtrend_vip" } },
                  { "type": "button", "style": "primary", "height": "sm", "color": "#404040", "action": { "type": "uri", "label": "ğŸ“˜ å¾¡è¬™ Facebook", "uri": "https://www.facebook.com/share/1CsML2XrDx/" } },
                  { "type": "button", "style": "primary", "height": "sm", "color": "#404040", "action": { "type": "uri", "label": "ğŸ“ å…¬å¸åœ°å€", "uri": "https://maps.app.goo.gl/81JB2KBH2fMA87Dz7" } }
                ]
              }
            }
          ]
        };

        function showUI(id, msg = "") {
            document.getElementById('statusUI').classList.add('hidden');
            document.getElementById('manualUI').classList.add('hidden');
            document.getElementById('errorUI').classList.add('hidden');
            if(id === 'errorUI') {
                document.getElementById('errorDetail').innerText = msg;
                let env = "Env: ";
                try { env += liff.getOS() + " / " + liff.getLanguage() + " / " + liff.getVersion(); } catch(e){}
                document.getElementById('envInfo').innerText = env;
            }
            document.getElementById(id).classList.remove('hidden');
        }

        async function sendRoseCard() {
            try {
                const res = await liff.shareTargetPicker([
                    {
                        "type": "flex",
                        "altText": "è‹¥æ…ˆèˆ‡æ‚¨åˆ†äº«æ•¸ä½åç‰‡",
                        "contents": roseJson
                    }
                ]);
                
                if (res) { 
                    liff.closeWindow(); 
                } else { 
                    showUI('manualUI'); 
                }
            } catch (err) {
                console.error(err);
                const code = err.code || "Unknown";
                const message = err.message || JSON.stringify(err);

                // [Fix] å®¹éŒ¯è™•ç†ï¼šé‡å° EXCEPTION_IN_SUBWINDOW (é€šå¸¸æ˜¯ç”¨æˆ¶å–æ¶ˆæˆ–é—œé–‰è¦–çª—)
                // é¡¯ç¤º Manual UI è€Œé Error UIï¼Œè®“é«”é©—ä¸ä¸­æ–·
                if (code === "EXCEPTION_IN_SUBWINDOW" || message.includes("EXCEPTION_IN_SUBWINDOW")) {
                    console.log("Subwindow exception handled, showing manual UI");
                    showUI('manualUI');
                    return; 
                }

                showUI('errorUI', `[${code}] ${message}`);
            }
        }

        async function main() {
            try {
                await liff.init({ liffId: MY_LIFF_ID });
                if (!liff.isLoggedIn()) {
                    liff.login();
                } else {
                    sendRoseCard();
                }
            } catch (err) {
                showUI('errorUI', "LIFF Init Error: " + err.message);
            }
        }
        window.onload = main;
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>
</body>
</html>